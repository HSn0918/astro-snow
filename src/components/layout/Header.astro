---
import logoSrc from 'src/assets/logo.webp?url';
import { MobilePostHeader } from '@components/layout/MobilePostHeader';
import { MenuIcon } from '@components/ui/MenuIcon';
import { MAX_WIDTH } from '@constants/layout';
import { Routes } from '@constants/router';
import { blogLayoutConfig } from '@/config/blogLayoutConfig';
import Navigator from './Navigator.astro';

interface Props {
  isPostPage?: boolean;
  tocNumbering?: boolean;
}

const { isPostPage = false, tocNumbering = true } = Astro.props;
const { alternate, title, showLogo } = blogLayoutConfig;
---

<div
  id="site-header"
  class={`shadow-text fixed tablet:backdrop-blur inset-x-0 top-0 z-10 gap-4 py-2.5 text-white select-none tablet:py-2 tablet:pl-3 tablet:pr-3`}
  transition:name="site-header"
>
  <div class={`mx-auto flex items-center justify-between tablet:w-full px-6 tablet:px-0 ${MAX_WIDTH.content}`}>
    <!-- Desktop: Always show logo -->
    <a
      transition:persist="page-header-avatar"
      class="tablet:hidden -my-4 mr-4 flex cursor-pointer items-center justify-center gap-1 whitespace-nowrap"
      href={Routes.Home}
      target="_self"
      title={alternate || title}
      aria-label={alternate || title}
    >
      {showLogo ? (
        <img src={logoSrc} alt={alternate || title} class="h-16 mt-2 mb-2" />
      ) : (
        <p class="logo-text text-primary">{alternate || title}</p>
      )}
    </a>

    <!-- Mobile: Menu button + Logo/Header -->
    <div class="hidden tablet:flex items-center grow">
      <!-- 移动端菜单按钮 -->
      <div id="mobile-menu-container" class="shrink-0">
        <MenuIcon client:load />
      </div>
      <!-- 移动端logo（非文章页）或 MobilePostHeader（文章页显示标题）- 居中显示 -->
      <div class="flex-1 flex items-center justify-center">
        {isPostPage ? (
          <MobilePostHeader
            client:load
            isPostPage={isPostPage}
            enableNumbering={tocNumbering}
            logoElement={showLogo ? 'svg' : 'text'}
            logoText={alternate || title}
            logoSrc={logoSrc}
          />
        ) : (
          <a
            href={Routes.Home}
            class="flex items-center gap-1"
            title={alternate || title}
            aria-label={alternate || title}
          >
            {showLogo ? (
              <img src={logoSrc} alt={alternate || title} class="h-8" />
            ) : (
              <span class="logo-text text-primary">{alternate || title}</span>
            )}
          </a>
        )}
      </div>
    </div>

    <Navigator transition:name="page-header" />
  </div>
</div>
